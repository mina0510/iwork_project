<!DOCTYPE html>
<html lang="zh-tw">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="/jQuery/jquery-3.6.0.js"></script>
    <!-- style -->
    <link rel="stylesheet" href="/css/shared/button.css" />
    <link rel="stylesheet" href="/css/shared/background.css" />
    <link rel="stylesheet" href="/css/shared/content6_1_2_style.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <!-- 修改、刪除紐前面圖式 -->
    <link rel="stylesheet" href="https://unpkg.com/bootstrap@3.3.7/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8"
        crossorigin="anonymous"></script>
    <script src="/js/apart/apart.js"></script>
</head>


<body class="zh-tw">
    <!-- 修改 -->
    <div>
        <ul class="nav nav-tabs">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle active" data-bs-toggle="dropdown" href="#" role="button"
                    aria-expanded="false">帳號管理</a>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="./CMS_6System.html">帳號權限管理</a></li>
                    <li><a class="dropdown-item" href="./CMS_6_1_2.html">新增帳號</a></li>
                    <li><a class="dropdown-item active" href="#">修改帳號</a></li>    
                </ul>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button"
                    aria-expanded="false">公告</a>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="./CMS_6_2_1.html">公告紀錄</a></li>
                    <li><a class="dropdown-item" href="./CMS_6_2_2.html">新增公告</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <a class="nav-link " aria-current="page" href="./CMS_6_3_1.html">推播</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " aria-current="page" href="./CMS_6_4_1.html">出勤管理</a>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button"
                    aria-expanded="false">點餐系統</a>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="./CMS_6_5_1.html">點餐紀錄</a></li>
                    <li><a class="dropdown-item" href="./CMS_6_5_2.html">設定餐廳</a></li>
                </ul>
            </li>
        </ul>
    </div>
    <div>
        <!-- 修改帳號 -->
        <br>
            <table cellspacing=10>
                <tbody class="帳號管理">
                    <tr>
                        <td><b><span>員&nbsp;&nbsp;&nbsp;工&nbsp;&nbsp;&nbsp;編&nbsp;&nbsp;&nbsp;號：</span></b></td>
                        <td id="empId"></td>
                    </tr>
                    <tr>
                        <td><b><span>密&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;碼：</span></b>
                        </td>
                        <td><input type="text" id="passwd" class="inputSize" value=""></td>
                    </tr>
                    <tr>
                        <td><b><span>姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名：</span></b>
                        </td>
                        <td><input type="text" id="empName" class="inputSize" value=""></td>
                    </tr>
                    <tr>
                        <td><b><span>部&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;門：</span></b>
                        </td>
                        <td>
                            <select id="aparts" value="">
                                <option value=''></option>
                            </select>&nbsp;&nbsp;&nbsp;&nbsp;
                        </td>
                    </tr>
                    <tr>
                        <td><b><span>電&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;話：</span></b>
                        </td>
                        <td><input id="tel" type="text" class="inputSize" value=""></td>
                    </tr>
                    <tr>
                        <td><b><span>性&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;別：</span></b>
                        </td>
                        <td>
                            <input id="genderMale" type="radio" name="gender" value="男" ><label for="genderMale">男性</label>&nbsp;&nbsp;
                            <input id="genderFemale" type="radio" name="gender" value="女"><label for="genderFemale">女性</label>
                        </td>
                    </tr>
                    <tr>
                        <td><b><span>行&nbsp;&nbsp;&nbsp;動&nbsp;&nbsp;&nbsp;電&nbsp;&nbsp;&nbsp;話：</span></b></td>
                        <td><input id="cellphone1" type="text" class="inputSize" value=""></td>
                    </tr>
                    <tr>
                        <td><b><span>E - M a i l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;：</span></b></td>
                        <td><input id="email" type="email" class="inputSize" value=""></td>
                    </tr>
                    <tr>
                        <td><b><span>地&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;址：</span></b>
                        </td>
                        <td><input id="addr" type="text" class="inputSize" value=""></td>
                    </tr>
                    <tr>
                        <td><b><span>系&nbsp;統&nbsp;管&nbsp;理&nbsp;員&nbsp;：</span></b></td>
                        <td>
                            <select id="adm" value="">
                                <option value="admin">管理者</option>
                                <option value="user">使用者</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><b><span>最&nbsp;後&nbsp;異&nbsp;動&nbsp;人&nbsp;：</span></b></td>
                        <td id="updatePerson"></td>
                    </tr>
                    <tr>
                        <td><b><span>最後異動時間&nbsp;：</span></b></td>
                        <td id="updateDate">
                        </td>
                    </tr>
                    <tr>
                        <td><b><span>建&nbsp;&nbsp;立&nbsp;&nbsp;時&nbsp;&nbsp;間&nbsp;&nbsp;：</span></b></td>
                        <td id="createDate">
                        </td>
                    </tr>
                    <tr>
                        <td><b><span>建&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;立&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;人&nbsp;：</span></b>
                        </td>
                        <td id="createPerson"></td>
                    </tr>
                    <tr>
                        <td><button id="sendToUpdateBtn" class="btnStyle">確定更改</td>
                    </tr>
                </tbody>
            </table>

    </div>

    <script>
        $(document).ready(()=> getThisUserInfo());

        function getThisUserInfo() {
            $("#empId").text(window.localStorage.getItem("empId"));
            var empData = JSON.stringify({
                empId: window.localStorage.getItem("empId")
            })
            $.ajax({
                type: "post",
                url: "/emp/getUserInfo/empId",
                data: empData,
                contentType: "application/json",
                dataType: 'json',
                success: function (data) {
                    $("#addr").val(data.addr);
                    $("#empName").val(data.empName);
                    $("#adm").val(data.adm);
                    $("#aparts").val(data.aparts.apartId);
                    $("#cellphone1").val(data.cellphone1);
                    $("#email").val(data.email);
                    $("#empName").val(data.empName);
                    $(`input[value=${data.gender}]`).attr("checked","true");
                    $("#passwd").val(data.passwd);
                    $("#tel").val(data.tel);
                    $("#createPerson").text(data.createPerson);
                    $("#updatePerson").text(data.updatePerson);
                    $("#createDate").text(data.createDate);
                    $("#updateDate").text(data.updateDate);

                }

            });


        }



        function getCookie() {
            var cookie = document.cookie.split('=');
            return cookie[1].toString();
        }

        $("#sendToUpdateBtn").click(function () {
            var newData = JSON.stringify({
                empId : $("#empId").text(),
                passwd: $("#passwd").val(),
                empName: $("#empName").val(),
                apartId: $("#aparts").val(),
                tel: $("#tel").val(),
                gender: $("input[name=gender]:checked").val(),
                cellphone1: $("#cellphone1").val(),
                email: $("#email").val(),
                addr: $("#addr").val(),
                adm: $("#adm").val(),
                updatePerson: getCookie()
            });

            $.ajax({
                type: "post",
                url: "/account/updateToEmployee",
                data: newData,
                contentType: "application/json",
                success: function () {
                    alert("修改成功");
                    window.location.href = "./CMS_6System.html";
                }
            });

        });
   

   </script>
</body>

</html>